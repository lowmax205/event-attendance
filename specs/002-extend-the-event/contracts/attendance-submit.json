{
  "operation": "attendance-submit",
  "description": "Submit attendance record with location, photos, and signature",
  "method": "POST",
  "endpoint": "/api/attendance",
  "authentication": "Required (Student role)",
  "requestSchema": {
    "type": "object",
    "required": [
      "eventId",
      "latitude",
      "longitude",
      "frontPhotoBase64",
      "backPhotoBase64",
      "signatureBase64"
    ],
    "properties": {
      "eventId": {
        "type": "string",
        "description": "Event ID from scanned QR code",
        "example": "clxyz123abc456def789"
      },
      "latitude": {
        "type": "number",
        "minimum": -90,
        "maximum": 90,
        "description": "Student's current GPS latitude",
        "example": 14.5995
      },
      "longitude": {
        "type": "number",
        "minimum": -180,
        "maximum": 180,
        "description": "Student's current GPS longitude",
        "example": 120.9842
      },
      "frontPhotoBase64": {
        "type": "string",
        "pattern": "^data:image/(jpeg|png);base64,",
        "description": "Base64-encoded front photo (ID/badge)",
        "example": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
      },
      "backPhotoBase64": {
        "type": "string",
        "pattern": "^data:image/(jpeg|png);base64,",
        "description": "Base64-encoded back photo (selfie)",
        "example": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
      },
      "signatureBase64": {
        "type": "string",
        "pattern": "^data:image/png;base64,",
        "description": "Base64-encoded signature (transparent PNG)",
        "example": "data:image/png;base64,iVBORw0KGgo..."
      }
    }
  },
  "responseSchema": {
    "type": "object",
    "required": [
      "id",
      "eventId",
      "userId",
      "submittedAt",
      "verificationStatus"
    ],
    "properties": {
      "id": {
        "type": "string",
        "description": "Attendance record ID",
        "example": "clabc456def789xyz123"
      },
      "eventId": {
        "type": "string"
      },
      "userId": {
        "type": "string"
      },
      "submittedAt": {
        "type": "string",
        "format": "date-time"
      },
      "latitude": {
        "type": "number"
      },
      "longitude": {
        "type": "number"
      },
      "distanceFromVenue": {
        "type": "number",
        "description": "Calculated distance in meters",
        "example": 45.2
      },
      "frontPhotoUrl": {
        "type": "string",
        "format": "uri",
        "description": "Cloudinary URL for front photo"
      },
      "backPhotoUrl": {
        "type": "string",
        "format": "uri",
        "description": "Cloudinary URL for back photo"
      },
      "signatureUrl": {
        "type": "string",
        "format": "uri",
        "description": "Cloudinary URL for signature"
      },
      "verificationStatus": {
        "type": "string",
        "enum": ["Pending", "Approved", "Rejected", "Disputed"],
        "example": "Pending"
      },
      "event": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "startDateTime": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    }
  },
  "errorResponses": {
    "400": {
      "description": "Validation error",
      "example": {
        "error": "Validation failed",
        "details": [
          {
            "field": "distanceFromVenue",
            "message": "Location verification failed: Not within 100m of venue (distance: 250m)"
          }
        ]
      }
    },
    "401": {
      "description": "Not authenticated",
      "example": {
        "error": "Authentication required"
      }
    },
    "403": {
      "description": "Profile incomplete or wrong role",
      "example": {
        "error": "Profile incomplete: Please complete your profile before checking in"
      }
    },
    "404": {
      "description": "Event not found",
      "example": {
        "error": "Event not found"
      }
    },
    "409": {
      "description": "Duplicate check-in",
      "example": {
        "error": "You have already checked in to this event",
        "previousCheckIn": "2025-10-15T09:30:00Z"
      }
    },
    "422": {
      "description": "Business rule violation",
      "examples": [
        {
          "error": "Check-in window not open",
          "message": "Check-in opens at 2025-10-15T08:30:00Z (30 minutes before event)"
        },
        {
          "error": "Device is offline",
          "message": "Internet connection required for attendance submission"
        }
      ]
    },
    "500": {
      "description": "Image upload failed",
      "example": {
        "error": "Failed to upload photos to Cloudinary",
        "retryable": true
      }
    }
  },
  "businessRules": [
    "Student's profile must be complete (all required fields filled)",
    "Event must be Active status",
    "Current time must be within event's check-in window (startDateTime - checkInBufferMins to endDateTime + checkOutBufferMins)",
    "Student's location must be within 100 meters of venue coordinates",
    "No duplicate check-in allowed (unique constraint on eventId + userId)",
    "Internet connectivity required (no offline queue)",
    "Images uploaded to Cloudinary with folder structure: {CLOUDINARY_FOLDER}/attendance/{eventId}/{userId}/{timestamp}_{attendanceId}_{front|back|signature}.{jpg|png}",
    "CLOUDINARY_FOLDER environment variable used as root folder prefix to separate from other API content",
    "Default verificationStatus is Pending",
    "Distance calculated server-side using Haversine formula",
    "IP address and user agent logged for audit trail"
  ],
  "performanceTargets": {
    "totalResponseTime": "< 5 seconds (including 3 Cloudinary uploads)",
    "imageUploadTimeout": "30 seconds per image",
    "locationVerificationLatency": "< 100ms"
  }
}
